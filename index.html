
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Galeria de Bonsais</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #fdfdfd; }
        h1 { color: darkgreen; }
        select, input[type="text"] { margin-top: 10px; padding: 5px; }
        #log { margin-top: 20px; color: red; white-space: pre-wrap; }
        #galeria img { max-height: 200px; margin: 10px; display: inline-block; }
    </style>
</head>
<body>
    <h1>Galeria de Bonsais</h1>
    <label for="categoria">Categoria:</label>
    <select id="categoria"><option>Selecionar categoria</option></select>

    <label for="especie">Espécie:</label>
    <input type="text" id="pesquisarEspecie" placeholder="Pesquisar espécie..." />
    <select id="especie"><option>Selecionar espécie</option></select>

    <label for="estilo">Estilo:</label>
    <select id="estilo"><option>Todos</option></select>

    <div id="galeria"></div>
    <div id="log" style="color:red;">logs (v2.06i):</div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            log("JS carregado e DOM pronto.");

            const categorias = {
                "Coniferas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=1843801978&single=true&output=csv",
                "Caducifolias": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=201209602&single=true&output=csv",
                "Perenifolias": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=80791632&single=true&output=csv",
                "Frutiferas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=1484284661&single=true&output=csv",
                "Floriferas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=1968818289&single=true&output=csv"
            };

            const categoriaSelect = document.getElementById("categoria");
            const especieSelect = document.getElementById("especie");
            const galeria = document.getElementById("galeria");

            function log(mensagem) {
                console.log(mensagem);
                document.getElementById("log").innerText += "\n" + mensagem;
            }

            function limparGaleria() {
                galeria.innerHTML = "";
            }

            function limparDropdownEspecies() {
                especieSelect.innerHTML = '<option>Selecionar espécie</option>';
            }

            async function carregarCSV(url) {
                const resposta = await fetch(url);
                const texto = await resposta.text();
                return texto.split('\n').map(linha => linha.split(',')).filter(l => l[0] && l[1]);
            }

            async function carregarCategorias() {
                for (let cat in categorias) {
                    let opt = document.createElement("option");
                    opt.value = cat;
                    opt.textContent = cat;
                    categoriaSelect.appendChild(opt);
                }
                log("Categorias carregadas.");
            }

            async function carregarEspeciesECriarGaleria(categoria) {
                limparGaleria();
                limparDropdownEspecies();
                if (!categoria || !categorias[categoria]) return;

                try {
                    log("A carregar dados da categoria: " + categoria);
                    const linhas = await carregarCSV(categorias[categoria]);
                    linhas.forEach((linha, idx) => {
                        const [estilo, url] = linha;
                        if (!url) return;

                        let opt = document.createElement("option");
                        opt.value = "esp" + idx;
                        opt.textContent = `#${idx + 1}`;
                        especieSelect.appendChild(opt);

                        let img = document.createElement("img");
                        img.src = url;
                        img.alt = estilo || "bonsai";
                        galeria.appendChild(img);
                    });
                    log("Imagens e espécies carregadas para " + categoria);
                } catch (e) {
                    log("Erro ao carregar: " + e.message);
                }
            }

            categoriaSelect.addEventListener("change", () => {
                const cat = categoriaSelect.value;
                carregarEspeciesECriarGaleria(cat);
            });

            carregarCategorias();
        });
    </script>
</body>
</html>
