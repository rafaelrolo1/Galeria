<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Galeria de Bonsais</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { color: darkgreen; }
    select { margin: 5px; padding: 5px; }
    #log { margin-top: 20px; color: red; white-space: pre-wrap; }
    .galeria { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
    .galeria div { text-align: center; }
    .galeria img { width: 200px; height: auto; border-radius: 8px; cursor: pointer; }
    .fullscreen-img {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      object-fit: contain; background-color: rgba(0,0,0,0.95);
      z-index: 1000; display: none; cursor: zoom-out;
    }
    .dark { background-color: #111; color: #eee; }
    .dark select, .dark input { background-color: #333; color: #eee; }
    .dark .galeria div { background-color: #222; }
  </style>
</head>
<body>
<h1>Galeria de Bonsais</h1>
<label>Categoria:
  <select id="categoriaSelect"><option value="">Todas</option></select>
</label>
<label>EspÃ©cie:
  <select id="especieSelect"><option value="">Todas</option></select>
</label>
<label>Sub-espÃ©cie:
  <select id="subespecieSelect"><option value="">Todas</option></select>
</label>
<label>Estilo:
  <select id="estiloSelect"><option value="">Todos</option></select>
</label>
  
<div style="margin: 10px 0;">
  <button id="btnRepor" style="margin-right: 10px; padding: 8px; border-radius: 6px; cursor: pointer;">
    ðŸ”„ Repor Filtros
  </button>
  
  <a href="https://..." target="_blank">
    <a href="https://script.google.com/macros/s/AKfycbyK7iS0giL5u-8dqY8XV8Q36ZSazuyWKBuxZ8hXSvKd7daCiucxbXFtu8GVYhgT_nMP/exec" target="_blank">
    <button style="padding:10px 20px; background:#007BFF; color:white; border:none; border-radius:5px; cursor:pointer;">
      âž• Adicionar Novo Bonsai
    </button>
  </a>
</div>

<div class="galeria" id="galeria"></div>
<div id="log">logs (v3.06):</div>
<img id="fullscreenImage" class="fullscreen-img" />
<button id="btnDarkMode" style="position:fixed;top:20px;right:20px;z-index:1001;padding:8px;border:none;border-radius:6px;cursor:pointer;background:#333;color:#fff;">ðŸŒ™</button>

<script>
const apiKey = "AIzaSyAwYMSAn6yrut3thb5c0hrHONWnLTI1OWM";
const sheetId = "1VszHZn6YCPHGMhNzetQMpozbxxqK6KC1U9SNb_BzK7I";
const range = "Bonsai_Gallery!A2:E500";

const categoriaSelect = document.getElementById("categoriaSelect");
const especieSelect = document.getElementById("especieSelect");
const subespecieSelect = document.getElementById("subespecieSelect");
const estiloSelect = document.getElementById("estiloSelect");
const galeria = document.getElementById("galeria");

let dados = [];

function log(msg) {
  document.getElementById("log").textContent += "\n" + msg;
}

async function fetchDados() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
  const res = await fetch(url);
  const json = await res.json();
  dados = json.values.map((r, i) => ({
    categoria: r[0] || "",
    especie: r[1] || "",
    subespecie: r[2] || "",
    estilo: r[3] || "",
    link: r[4] || "",
    numero: i + 2
  }));
  atualizarFiltros();
  atualizarGaleria();
}

function atualizarFiltros() {
  const categorias = new Set(), especies = new Set(), subespecies = new Set(), estilos = new Set();
  const cat = categoriaSelect.value, esp = especieSelect.value;

  dados.forEach(d => {
    if (!cat || d.categoria === cat) categorias.add(d.categoria);
    if (!cat || d.categoria === cat) especies.add(d.especie);
    if ((!cat || d.categoria === cat) && (!esp || d.especie === esp)) subespecies.add(d.subespecie);
    estilos.add(d.estilo);
  });

  atualizarSelect(categoriaSelect, [...categorias], "Todas");
  atualizarSelect(especieSelect, [...especies], "Todas");
  atualizarSelect(subespecieSelect, [...subespecies], "Todas");
  atualizarSelect(estiloSelect, [...estilos], "Todos");
}

function atualizarSelect(select, valores, label) {
  const atual = select.value;
  select.innerHTML = `<option value="">${label}</option>` + valores.sort().map(v =>
    `<option value="${v}">${v}</option>`).join("");
  select.value = atual;
}

function atualizarGaleria() {
  const cat = categoriaSelect.value, esp = especieSelect.value;
  const sub = subespecieSelect.value, est = estiloSelect.value;
  galeria.innerHTML = "";

  dados.forEach((d, i) => {
    if ((cat && d.categoria !== cat) || (esp && d.especie !== esp) ||
        (sub && d.subespecie !== sub) || (est && d.estilo !== est)) return;

    if (d.link) {
      const div = document.createElement("div");
      const img = document.createElement("img");
      const label = document.createElement("div");
      img.src = d.link;
      img.onclick = () => abrirFullscreen(d.link);
      label.innerHTML = `#${d.numero} - ${d.especie}${d.subespecie ? " " + d.subespecie : ""}<br>${d.estilo ? d.estilo : ""}`;
      div.appendChild(img);
      div.appendChild(label);
      galeria.appendChild(div);
    }
  });
}

function abrirFullscreen(src) {
  const fs = document.getElementById("fullscreenImage");
  fs.src = src;
  fs.style.display = "block";
}

document.getElementById("fullscreenImage").onclick = () => {
  document.getElementById("fullscreenImage").style.display = "none";
};

[categoriaSelect, especieSelect, subespecieSelect, estiloSelect].forEach(sel =>
  sel.addEventListener("change", () => {
    atualizarFiltros();
    atualizarGaleria();
  })
);
  
document.getElementById("btnRepor").onclick = () => {
  categoriaSelect.value = "";
  especieSelect.value = "";
  subespecieSelect.value = "";
  estiloSelect.value = "";
  atualizarFiltros();
  atualizarGaleria();
};

document.getElementById("btnDarkMode").onclick = () =>
  document.body.classList.toggle("dark");

fetchDados();
</script>
</body>
</html>
