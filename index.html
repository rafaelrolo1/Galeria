
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <title>Galeria de Bonsais</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { color: darkgreen; }
    select { margin: 10px; padding: 5px; }
    #log { margin-top: 20px; color: red; white-space: pre-wrap; }
    .galeria { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
    .galeria div { text-align: center; }
    .galeria img { width: 200px; height: auto; border-radius: 10px; cursor: pointer; }
    select.auto-selected { background-color: #d1fadf; border-color: green; }
    .fullscreen-img {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: contain;
      background-color: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      display: none;
      cursor: zoom-out;
    }
    .dark {
      background-color: #111;
      color: #eee;
    }
    .dark select, .dark input {
      background-color: #333;
      color: #eee;
    }
    .dark .galeria div {
      background-color: #222;
    }
  </style>
</head>
<body>
<h1>Galeria de Bonsais</h1>
<label>Categoria:
  <select id="categoriaSelect"><option value="">Todas</option></select>
</label>
<label>EspÃ©cie:
  <select id="especieSelect"><option value="">Todas</option></select>
</label>
<label>Estilo:
  <select id="estiloSelect"><option value="">Todos</option></select>
</label>
<div class="galeria" id="galeria"></div>
<div id="log">logs (v3.10):</div>
<script>
const apiKey = "AIzaSyAwYMSAn6yrut3thb5c0hrHONWnLTI1OWM";
const sheetId = "1VszHZn6YCPHGMhNzetQMpozbxxqK6KC1U9SNb_BzK7I";
const folhaDados = "Bonsai_Gallery";

const categoriaSelect = document.getElementById("categoriaSelect");
const especieSelect = document.getElementById("especieSelect");
const estiloSelect = document.getElementById("estiloSelect");
const galeria = document.getElementById("galeria");
const logEl = document.getElementById("log");
const fullscreenImage = document.getElementById("fullscreenImage");
const btnDarkMode = document.getElementById("btnDarkMode");

let todosDados = [];

function log(msg) {
  logEl.textContent += "\n" + msg;
  console.log(msg);
}

async function fetchDados() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${folhaDados}!A2:E1000?key=${apiKey}`;
  const res = await fetch(url);
  const data = await res.json();
  return (data.values || []).map((row, idx) => ({
    categoria: row[0] || "",
    especie: row[1] || "",
    subespecie: row[2] || "",
    estilo: row[3] || "",
    imagem: row[4] || "",
    linha: idx + 2
  }));
}

function preencherDropdowns(dados) {
  const categorias = [...new Set(dados.map(d => d.categoria))].sort();
  const especies = [...new Set(dados.map(d => d.especie))].sort();
  const estilos = [...new Set(dados.map(d => d.estilo))].sort();

  categoriaSelect.innerHTML = '<option value="">Todas</option>';
  categorias.forEach(v => {
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v;
    categoriaSelect.appendChild(opt);
  });

  especieSelect.innerHTML = '<option value="">Todas</option>';
  especies.forEach(v => {
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v;
    especieSelect.appendChild(opt);
  });

  estiloSelect.innerHTML = '<option value="">Todos</option>';
  estilos.forEach(v => {
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v;
    estiloSelect.appendChild(opt);
  });
}

function aplicarFiltros() {
  const cat = categoriaSelect.value;
  const esp = especieSelect.value;
  const est = estiloSelect.value;

  const filtrados = todosDados.filter(d =>
    (!cat || d.categoria === cat) &&
    (!esp || d.especie === esp) &&
    (!est || d.estilo === est)
  );

  mostrarGaleria(filtrados);
}

function mostrarGaleria(dados) {
  galeria.innerHTML = "";
  dados.forEach(d => {
    if (!d.imagem) return;
    const div = document.createElement("div");
    const img = document.createElement("img");
    const legend = document.createElement("div");
    img.src = d.imagem;
    img.title = `${d.estilo}`;
    img.onclick = () => abrirFullscreen(d.imagem);
    legend.textContent = `${d.especie} - ${d.estilo} - #${d.linha}`;
    legend.style.fontSize = "14px";
    legend.style.color = "#555";
    div.appendChild(img);
    div.appendChild(legend);
    galeria.appendChild(div);
  });
}

function abrirFullscreen(src) {
  fullscreenImage.src = src;
  fullscreenImage.style.display = "block";
}
fullscreenImage.onclick = () => fullscreenImage.style.display = "none";
btnDarkMode.onclick = () => document.body.classList.toggle("dark");

categoriaSelect.onchange = aplicarFiltros;
especieSelect.onchange = aplicarFiltros;
estiloSelect.onchange = aplicarFiltros;

(async () => {
  todosDados = await fetchDados();
  preencherDropdowns(todosDados);
  aplicarFiltros();
  log("logs (v3.10): dados carregados com sucesso.");
})();
</script>
<img class="fullscreen-img" id="fullscreenImage" />
<button id="btnDarkMode" style="position:fixed;top:20px;right:20px;z-index:1001;padding:8px;border:none;border-radius:6px;cursor:pointer;background:#333;color:#fff;">ðŸŒ™</button>
</body>
</html>
