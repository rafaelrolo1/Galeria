
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Debug Categoria</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { color: darkgreen; }
    select { margin: 10px; padding: 5px; }
    #log { margin-top: 20px; color: red; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h1>Galeria de Bonsais</h1>

  <label>Categoria:
    <select id="categoriaSelect">
      <option value="">A carregar...</option>
    </select>
  </label>

  <label>Espécie:
    <select id="especieSelect">
      <option value="">Seleciona uma categoria primeiro</option>
    </select>
  </label>

  <div id="log">Logs:</div>

  <script>
    const sheetLinks = {
      "Categoria": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=0&single=true&output=csv",
      "Coniferas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=1843801978&single=true&output=csv",
      "Caducifolias": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=201209602&single=true&output=csv",
      "Perenifolias": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=80791632&single=true&output=csv",
      "Frutiferas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=1484284661&single=true&output=csv",
      "Floriferas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pubhtml?gid=1968818289&single=true"
    };

    function log(msg) {
      document.getElementById("log").textContent += "\n" + msg;
    }

    async function fetchCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      const rows = text.trim().split('\n').map(r => r.split(','));
      return rows;
    }

    const categoriaSelect = document.getElementById("categoriaSelect");
    const especieSelect = document.getElementById("especieSelect");

    async function carregarCategorias() {
      try {
        const categorias = await fetchCSV(sheetLinks["Categoria"]);
        categoriaSelect.innerHTML = '<option value="">Selecionar categoria</option>';
        categorias.forEach(([categoria]) => {
          const opt = document.createElement("option");
          opt.value = categoria.trim();
          opt.textContent = categoria.trim();
          categoriaSelect.appendChild(opt);
        });
        log("Categorias carregadas.");
      } catch (err) {
        log("Erro ao carregar categorias: " + err.message);
      }
    }

    categoriaSelect.addEventListener("change", async () => {
      const rawCategoria = categoriaSelect.value;
      const categoria = rawCategoria.trim();
      log("Categoria selecionada: '" + categoria + "'");
      especieSelect.innerHTML = '<option value="">A carregar...</option>';
      if (!sheetLinks[categoria]) {
        especieSelect.innerHTML = '<option value=''>Sem folha associada</option>';
        log("Não encontrada no sheetLinks: '" + categoria + "'");
        return;
      }
      try {
        const especies = await fetchCSV(sheetLinks[categoria]);
        especieSelect.innerHTML = '<option value="">Selecionar espécie</option>';
        especies.forEach(([esp]) => {
          const opt = document.createElement("option");
          opt.value = esp;
          opt.textContent = esp;
          especieSelect.appendChild(opt);
        });
        log("Espécies carregadas para: " + categoria);
      } catch (err) {
        log("Erro ao carregar espécies: " + err.message);
      }
    });

    document.addEventListener("DOMContentLoaded", carregarCategorias);
  </script>

</body>
</html>
