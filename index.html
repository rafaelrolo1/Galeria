
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Galeria de Bonsais</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    select { margin: 10px; padding: 5px; }
    #galeria img { height: 200px; margin: 5px; }
    #log { color: red; margin-top: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Galeria de Bonsais</h1>

  <label for="categoria">Categoria:</label>
  <select id="categoria">
    <option value="">Selecionar categoria</option>
  </select>

  <div id="galeria"></div>
  <div id="log">logs (v2.06-final4):</div>

  <script>
    const categoriaSelect = document.getElementById("categoria");
    const galeria = document.getElementById("galeria");
    const logDiv = document.getElementById("log");

    const sheetId = "1VszHZn6YCPHGMhNzetQMpozbxxqK6KC1U9SNb_BzK7I";
    const apiKey = "AIzaSyAwYMSAn6yrut3thb5c0hrHONWnLTI1OWM";

    const categorias = {
      "Coniferas": "1843801978",
      "Caducifolias": "201209602",
      "Perenifolias": "80791632",
      "Frutiferas": "1484284661",
      "Floriferas": "1968818289"
    };

    function log(msg) {
      console.log(msg);
      logDiv.textContent += "\n" + msg;
    }

    async function fetchSheetValues(sheetName, range) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?key=${apiKey}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Erro: " + res.status);
      const data = await res.json();
      return data.values || [];
    }

    async function carregarImagensDaCategoria(cat) {
      galeria.innerHTML = "";
      log(`Carregando categoria: ${cat}`);

      const especies = await fetchSheetValues(cat, "A2:A100");
      log(`${especies.length} espécies encontradas.`);

      for (const [nomeEspecie] of especies) {
        if (!nomeEspecie) continue;
        log(`Carregando espécie: ${nomeEspecie}`);
        try {
          const dados = await fetchSheetValues(nomeEspecie, "A2:B100");
          for (const [estilo, link] of dados) {
            if (link && link.startsWith("http")) {
              const img = document.createElement("img");
              img.src = link.trim();
              img.title = `${nomeEspecie} (${estilo})`;
              galeria.appendChild(img);
            }
          }
        } catch (err) {
          log(`Erro ao carregar ${nomeEspecie}: ${err.message}`);
        }
      }

      log("Imagens carregadas.");
    }

    categoriaSelect.addEventListener("change", async () => {
      const cat = categoriaSelect.value;
      if (cat) await carregarImagensDaCategoria(cat);
    });

    // Carrega dropdown
    for (const cat in categorias) {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat;
      categoriaSelect.appendChild(opt);
    }
  </script>
</body>
</html>
