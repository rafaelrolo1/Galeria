
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Galeria de Bonsais - v2.07-fin</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    h1 { color: darkgreen; }
    select { margin: 10px; padding: 5px; }
    #log { margin-top: 20px; color: red; white-space: pre-line; }
    .galeria { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
    .galeria img { max-width: 200px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Galeria de Bonsais</h1>
  <label for="categoria">Categoria:</label>
  <select id="categoria"><option value="">Selecionar categoria</option></select>
  <div id="galeria" class="galeria"></div>
  <div id="log">logs (v2.07-fin):</div>

  <script>
    const apiKey = "AIzaSyAwYMSAn6yrut3thb5c0hrHONWnLTI1OWM";
    const sheetId = "1VszHZn6YCPHGMhNzetQMpozbxxqK6KC1U9SNb_BzK7I";

    const categorias = {
      "Coniferas": "1843801978",
      "Caducifolias": "201209602",
      "Perenifolias": "80791632",
      "Frutiferas": "1484284661",
      "Floriferas": "1968818289"
    };

    const categoriaSelect = document.getElementById("categoria");
    const galeria = document.getElementById("galeria");
    const log = document.getElementById("log");

    function logMessage(msg) {
      console.log(msg);
      log.textContent += "\n" + msg;
    }

    async function fetchSheetValues(sheetName, range) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/'${sheetName}'!${range}?key=${apiKey}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Erro: " + res.status);
      const data = await res.json();
      return data.values || [];
    }

    async function carregarImagensDaCategoria(categoria) {
      galeria.innerHTML = "";
      logMessage("Carregando categoria: " + categoria);
      try {
        const especies = await fetchSheetValues(categoria, "A1:A100");
        logMessage(`${especies.length} espécies encontradas.`);
        for (const [especie] of especies) {
          if (!especie) continue;
          logMessage("→ " + especie);
          try {
            const imagens = await fetchSheetValues(especie, "B1:B100");
            imagens.forEach(([estilo, link]) => {
              if (link && link.startsWith("http")) {
                const img = document.createElement("img");
                img.src = link.trim();
                img.alt = estilo || especie;
                galeria.appendChild(img);
              }
            });
          } catch (erro) {
            logMessage(`Erro ao carregar ${especie}: ${erro.message}`);
          }
        }
      } catch (e) {
        logMessage("Erro na categoria: " + e.message);
      }
    }

    categoriaSelect.addEventListener("change", () => {
      const cat = categoriaSelect.value;
      if (cat) carregarImagensDaCategoria(cat);
    });

    document.addEventListener("DOMContentLoaded", () => {
      logMessage("JS carregado e DOM pronto.");
      for (const nome in categorias) {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.textContent = nome;
        categoriaSelect.appendChild(opt);
      }
    });
  </script>
</body>
</html>
