
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8"/>
  <title>Galeria de Bonsais</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { color: darkgreen; }
    select { margin: 10px; padding: 5px; }
    #log { margin-top: 20px; color: red; white-space: pre-wrap; }
    .galeria { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
    .galeria div { text-align: center; }
    .galeria img { width: 200px; height: auto; border-radius: 10px; }
    .fullscreen-img {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      object-fit: contain; background-color: rgba(0, 0, 0, 0.95);
      z-index: 1000; display: none; cursor: zoom-out;
    }
    .dark { background-color: #111; color: #eee; }
    .dark select, .dark input { background-color: #333; color: #eee; }
  </style>
</head>
<body>
  <h1>Galeria de Bonsais</h1>
  <label>Categoria:
    <select id="categoriaSelect"><option value="">Todas</option></select>
  </label>
  <label>Espécie:
    <select id="especieSelect"><option value="">Todas</option></select>
  </label>
  <label>Sub-espécie:
    <select id="subespecieSelect"><option value="">Todas</option></select>
  </label>
  <label>Estilo:
    <select id="estiloSelect"><option value="">Todos</option></select>
  </label>
  <div class="galeria" id="galeria"></div>
  <div id="log">logs (v3.02):</div>
  <script>
    const apiKey = "AIzaSyAwYMSAn6yrut3thb5c0hrHONWnLTI1OWM";
    const sheetId = "1VszHZn6YCPHGMhNzetQMpozbxxqK6KC1U9SNb_BzK7I";
    const range = "Bonsai_Gallery!A2:E1000";

    const categoriaSelect = document.getElementById("categoriaSelect");
    const especieSelect = document.getElementById("especieSelect");
    const subespecieSelect = document.getElementById("subespecieSelect");
    const estiloSelect = document.getElementById("estiloSelect");
    const galeria = document.getElementById("galeria");

    let dadosPlanilha = [];

    function log(msg) {
      const el = document.getElementById("log");
      el.textContent += "\n" + msg;
      console.log(msg);
    }

    async function carregarDados() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();
      dadosPlanilha = data.values || [];
    }

    function popularDropdowns() {
      const categorias = new Set();
      const especies = new Set();
      const subespecies = new Set();
      const estilos = new Set();

      dadosPlanilha.forEach(row => {
        categorias.add(row[0]);
        especies.add(row[1]);
        subespecies.add(row[2]);
        estilos.add(row[3]);
      });

      function preencher(select, items) {
        select.innerHTML = `<option value="">Todas</option>`;
        [...items].sort().forEach(v => {
          const opt = document.createElement("option");
          opt.value = v;
          opt.textContent = v;
          select.appendChild(opt);
        });
      }

      preencher(categoriaSelect, categorias);
      preencher(especieSelect, especies);
      preencher(subespecieSelect, subespecies);
      preencher(estiloSelect, estilos);
    }

    function aplicarFiltros() {
      const cat = categoriaSelect.value;
      const esp = especieSelect.value;
      const sub = subespecieSelect.value;
      const est = estiloSelect.value;
      galeria.innerHTML = "";

      dadosPlanilha.forEach((row, idx) => {
        const [categoria, especie, subespecie, estilo, link] = row;
        if ((cat && categoria !== cat) ||
            (esp && especie !== esp) ||
            (sub && subespecie !== sub) ||
            (est && estilo !== est)) return;

        if (!link) return;

        const div = document.createElement("div");
        const img = document.createElement("img");
        img.src = link;
        img.alt = `${especie} - ${subespecie}`;
        img.title = estilo || "";
        img.onclick = () => {
          const fs = document.getElementById("fullscreenImage");
          fs.src = link;
          fs.style.display = "block";
        };
        const caption = document.createElement("div");
        caption.textContent = `${especie} ${subespecie || ""} - ${estilo}`;
        caption.style.fontSize = "13px";
        caption.style.color = "#555";

        div.appendChild(img);
        div.appendChild(caption);
        galeria.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await carregarDados();
      popularDropdowns();
      aplicarFiltros();
    });

    [categoriaSelect, especieSelect, subespecieSelect, estiloSelect].forEach(sel =>
      sel.addEventListener("change", aplicarFiltros)
    );

    document.body.addEventListener("click", e => {
      const fs = document.getElementById("fullscreenImage");
      if (e.target.id === "fullscreenImage") fs.style.display = "none";
    });
  </script>
  <img id="fullscreenImage" class="fullscreen-img"/>
</body>
</html>
