
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Galeria de Bonsais</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        h1 { color: darkgreen; }
        select, input { margin-top: 10px; padding: 5px; }
        #log { margin-top: 20px; color: red; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Galeria de Bonsais</h1>
    <label for="categoria">Categoria:</label>
    <select id="categoria"><option>Selecionar categoria</option></select>
    <label for="especie">Espécie:</label>
    <input type="text" id="pesquisarEspecie" placeholder="Pesquisar espécie..." />
    <select id="especie"><option>Selecionar espécie</option></select>
    <label for="estilo">Estilo:</label>
    <select id="estilo"><option>Todos</option></select>

    <div id="galeria"></div>
    <div id="log" style="color:red;">logs (v2.06l):</div>

    <script>
        const log = (msg) => document.getElementById("log").textContent += "\n" + msg;

        document.addEventListener("DOMContentLoaded", async () => {
            log("JS carregado e DOM pronto.");
            const categorias = ["Coniferas", "Caducifolias", "Frutiferas", "Floriferas", "Perenifolias"];
            const categoriaSelect = document.getElementById("categoria");

            categorias.forEach(cat => {
                const opt = document.createElement("option");
                opt.value = cat;
                opt.textContent = cat;
                categoriaSelect.appendChild(opt);
            });

            categoriaSelect.addEventListener("change", () => {
                const categoria = categoriaSelect.value;
                if (!categoria || categoria === "Selecionar categoria") return;
                carregarEspecies(categoria);
            });
        });

        async function carregarEspecies(categoria) {
            const especieSelect = document.getElementById("especie");
            especieSelect.innerHTML = "";

            const galeria = document.getElementById("galeria");
            galeria.innerHTML = "";

            log(`A carregar dados da categoria: ${categoria}`);

            try {
                const url = `https://docs.google.com/spreadsheets/d/e/2PACX-1vStQSVHrXRProUQe8Gsza--qC9Zod1qYnHRB8relEGkJ8pgyv850AGcmRAgFvrNsKQ3hEdNt0tknMUr/pub?gid=${{
                    Coniferas: "1843801978",
                    Caducifolias: "201209602",
                    Frutiferas: "1484284661",
                    Floriferas: "1968818289",
                    Perenifolias: "80791632"
                }[categoria]}&single=true&output=csv`;

                const response = await fetch(url);
                const data = await response.text();
                const linhas = data.split("\n").slice(1);

                log(`Espécies carregadas para: ${categoria}`);
                linhas.forEach((linha, idx) => {
                    const [estilo, link] = linha.split(",");
                    if (link) {
                        const opt = document.createElement("option");
                        opt.textContent = `${categoria} #${idx + 1}`;
                        especieSelect.appendChild(opt);

                        const img = document.createElement("img");
                        img.src = link.trim();
                        img.style = "width:200px;margin:10px;";
                        galeria.appendChild(img);
                    }
                });
            } catch (e) {
                log("Erro ao carregar: " + e.message);
            }
        }
    </script>
</body>
</html>
