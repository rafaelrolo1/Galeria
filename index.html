
<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Galeria de Bonsais</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        h1 { color: darkgreen; }
        select, input[type="text"] { margin-top: 10px; padding: 5px; }
        #log { margin-top: 20px; color: red; white-space: pre-wrap; }
        #galeria img { height: 200px; margin: 5px; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>Galeria de Bonsais</h1>
    <label for="categoria">Categoria:</label>
    <select id="categoria"><option>Selecionar categoria</option></select>

    <label for="especie">Espécie:</label>
    <input type="text" id="pesquisarEspecie" placeholder="Pesquisar espécie..." />
    <select id="especie"><option>Selecionar espécie</option></select>

    <label for="estilo">Estilo:</label>
    <select id="estilo"><option>Todos</option></select>

    <div id="galeria"></div>
    <div id="log" style="color:red;">logs (v2.06j):</div>

    <script>
        const sheetId = "1VszHZn6YCPHGMhNzetQMpozbxxqK6KC1U9SNb_BzK7I";
        const apiKey = "AIzaSyAwYMSAn6yrut3thb5c0hrHONWnLTI1OWM";

        const categoriaSelect = document.getElementById("categoria");
        const especieSelect = document.getElementById("especie");
        const estiloSelect = document.getElementById("estilo");
        const galeriaDiv = document.getElementById("galeria");
        const logDiv = document.getElementById("log");

        const categorias = ["Coniferas", "Caducifolias", "Perenifolias", "Frutiferas", "Floriferas"];
        const estiloLista = new Set();

        function log(msg) {
            console.log(msg);
            logDiv.textContent += "\n" + msg;
        }

        async function carregarCategorias() {
            log("Carregando categorias...");
            categorias.forEach(c => {
                const opt = document.createElement("option");
                opt.value = c;
                opt.textContent = c;
                categoriaSelect.appendChild(opt);
            });
            log("Categorias carregadas.");
        }

        async function carregarDadosCategoria(categoria) {
            log("A carregar dados da categoria: " + categoria);
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${categoria}!A1:B100?key=${apiKey}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("Erro HTTP " + response.status);
                const data = await response.json();
                const linhas = data.values.slice(1);

                especieSelect.innerHTML = '<option>Selecionar espécie</option>';
                galeriaDiv.innerHTML = '';
                estiloLista.clear();

                linhas.forEach((linha, i) => {
                    const estilo = linha[0] || "Desconhecido";
                    const link = linha[1];
                    const nome = `${categoria} #${i + 1}`;

                    const opt = document.createElement("option");
                    opt.value = link;
                    opt.textContent = nome;
                    especieSelect.appendChild(opt);

                    estiloLista.add(estilo);
                });

                estiloSelect.innerHTML = '<option>Todos</option>';
                estiloLista.forEach(est => {
                    const opt = document.createElement("option");
                    opt.value = est;
                    opt.textContent = est;
                    estiloSelect.appendChild(opt);
                });

                log("Espécies carregadas para: " + categoria);
            } catch (error) {
                log("Erro ao carregar: " + error.message);
            }
        }

        function mostrarImagemSelecionada() {
            const link = especieSelect.value;
            galeriaDiv.innerHTML = '';
            if (link.startsWith("http")) {
                const img = document.createElement("img");
                img.src = link;
                galeriaDiv.appendChild(img);
            }
        }

        categoriaSelect.addEventListener("change", e => {
            const categoria = e.target.value;
            if (categoria !== "Selecionar categoria") {
                carregarDadosCategoria(categoria);
            }
        });

        especieSelect.addEventListener("change", mostrarImagemSelecionada);

        document.addEventListener("DOMContentLoaded", () => {
            log("JS carregado e DOM pronto.");
            carregarCategorias();
        });
    </script>
</body>
</html>
